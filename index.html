<!DOCTYPE html>
<html lang="en">
<head>
    <!-- SEO & Performance Optimization by Gemini -->
    <!-- Document Metadata -->
    <meta charset="UTF-8">
    <title>Apple Glow | Interactive WebGL Shader Art</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Experience 'Apple Glow,' a mesmerizing interactive WebGL shader. Manipulate vibrant, glowing patterns and explore the beauty of generative art in your browser.">
    <meta name="keywords" content="webgl, shader, interactive art, generative art, creative coding, javascript, html5, graphics, visualization, apple glow">
    <meta name="author" content="Chris Pirillo">
    <link rel="canonical" href="https://pirillo.com/arcade/apple-glow.html">

    <!-- Open Graph (for social sharing) -->
    <meta property="og:title" content="Apple Glow | Interactive WebGL Shader Art">
    <meta property="og:description" content="A mesmerizing and interactive WebGL shader art experience.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pirillo.com/arcade/apple-glow.html">
    <meta property="og:image" content="https://pirillo.com/arcade/images/apple-glow.png">
    <meta property="og:image:alt" content="A vibrant, abstract glowing pattern generated by the Apple Glow shader.">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Chris Pirillo's Arcade">

    <!-- Twitter Card (for Twitter sharing) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@ChrisPirillo">
    <meta name="twitter:title" content="Apple Glow | Interactive WebGL Shader Art">
    <meta name="twitter:description" content="A mesmerizing and interactive WebGL shader art experience.">
    <meta name="twitter:image" content="https://pirillo.com/arcade/images/apple-glow.png">
    <meta name="twitter:image:alt" content="A vibrant, abstract glowing pattern generated by the Apple Glow shader.">

    <!-- 
      Resource Hints for Performance:
      - preconnect: Establishes an early connection to third-party origins.
      - preload: Fetches the font stylesheet early without blocking render.
    -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <!-- Fallback for browsers that don't support preload or have JavaScript disabled -->
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"></noscript>

    <!--
      NOTE: Per instructions, the Tailwind CSS script is not deferred.
      While this is render-blocking, it ensures the initial paint is correct without FOUC.
    -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 
        Critical CSS: Inlined for fastest rendering of initial UI elements. 
        This prevents layout shifts and improves perceived performance.
    -->
    <style>
        /* --- Base Styles & Fonts --- */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* --- WebGL Canvas --- */
        #glCanvas {
            z-index: 1;
            /* Explicitly set width/height to prevent CLS, JS will override for interactivity */
            width: 100vw;
            height: 100vh;
        }

        /* --- UI Container & Hamburger Menu --- */
        #ui-container {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
        }

        #menu-toggle {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 30;
            background-color: rgba(17, 24, 39, 0.5);
            backdrop-filter: blur(12px) saturate(180%);
            -webkit-backdrop-filter: blur(12px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        #menu-toggle:hover {
            background-color: rgba(31, 41, 55, 0.7);
            transform: scale(1.05);
        }

        .line {
            width: 24px;
            height: 2px;
            background-color: white;
            margin: 5px 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #menu-toggle.open .line1 { transform: rotate(-45deg) translate(-5px, 6px); }
        #menu-toggle.open .line2 { opacity: 0; }
        #menu-toggle.open .line3 { transform: rotate(45deg) translate(-5px, -6px); }

        /* --- Settings Panel --- */
        #settings-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 340px;
            height: 100%;
            background-color: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(16px) saturate(200%);
            -webkit-backdrop-filter: blur(16px) saturate(200%);
            border-right: 1px solid rgba(255, 255, 255, 0.12);
            z-index: 20;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }

        #settings-panel.open {
            transform: translateX(0);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .panel-header {
            padding: 1.5rem 1.5rem 1rem 5.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }
        .panel-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.025em;
        }
        .panel-subtitle {
            font-size: 0.875rem;
            color: #9ca3af;
        }
        
        #controls-container {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .control-card, .toggle-card {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }
        .control-card:hover, .toggle-card:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .control-label-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        .control-label { font-weight: 500; color: #d1d5db; }
        .control-value {
            font-family: 'SF Mono', 'Fira Code', 'Fira Mono', 'Roboto Mono', monospace;
            background-color: rgba(0, 0, 0, 0.3);
            color: #93c5fd;
            padding: 0.125rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            min-width: 50px;
            text-align: center;
        }
        
        .toggle-card { padding: 1rem; }
        .toggle-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .toggle-label { font-size: 1.125rem; font-weight: 500; color: #e5e7eb; }
        .toggle-switch {
            position: relative; display: inline-block;
            width: 50px; height: 28px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s; border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute; content: "";
            height: 20px; width: 20px;
            left: 4px; bottom: 4px;
            background-color: white;
            transition: .4s; border-radius: 50%;
        }
        input:checked + .toggle-slider { background-color: #3b82f6; }
        input:checked + .toggle-slider:before { transform: translateX(22px); }

        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 6px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 3px; outline: none; cursor: pointer;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 18px; height: 18px;
            background: #ffffff; border-radius: 50%;
            border: 2px solid #60a5fa;
            box-shadow: 0 0 8px rgba(96, 165, 250, 0.7);
            transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: -6px;
        }
        .slider-container { position: relative; }
        .slider-track-fill {
            position: absolute; top: 50%; left: 0;
            transform: translateY(-50%); height: 6px;
            background: linear-gradient(90deg, #60a5fa, #3b82f6);
            border-radius: 3px; pointer-events: none;
        }
    </style>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CQ4D3VQ3L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1CQ4D3VQ3L');
    </script>

    <!-- JSON-LD Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Apple Glow",
      "description": "Experience 'Apple Glow,' a mesmerizing interactive WebGL shader. Manipulate vibrant, glowing patterns and explore the beauty of generative art in your browser.",
      "url": "https://pirillo.com/arcade/apple-glow.html",
      "applicationCategory": "GameApplication",
      "operatingSystem": "All",
      "browserRequirements": "Requires WebGL support.",
      "author": {
        "@type": "Person",
        "name": "Chris Pirillo",
        "url": "https://pirillo.com/"
      },
      "image": "https://pirillo.com/arcade/images/apple-glow.png",
      "offers": {
        "@type": "Offer",
        "price": "0"
      }
    }
    </script>
</head>
<body>
    <!-- Using <main> for semantic HTML and to denote the primary content of the page -->
    <main>
        <canvas id="glCanvas" width="0" height="0">
            Your browser does not support the HTML canvas element, which is required for this interactive experience.
        </canvas>

        <nav id="ui-container" aria-label="Shader Controls">
            <button id="menu-toggle" aria-label="Toggle settings menu" aria-expanded="false" aria-controls="settings-panel">
                <div class="line line1"></div>
                <div class="line line2"></div>
                <div class="line line3"></div>
            </button>

            <aside id="settings-panel">
                <header class="panel-header">
                    <h1 class="panel-title">Apple Glow</h1>
                    <p class="panel-subtitle">Control Panel</p>
                </header>
                <section id="controls-container" aria-label="Shader parameters">
                    <!-- Dynamically generated settings will be inserted here -->
                </section>
            </aside>
        </nav>
    </main>

    <!-- 
      WebGL Shaders:
      Embedded directly into the HTML to avoid extra network requests.
    -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec2 a_position;
        void main() {
            gl_Position = vec4(a_position, 0.0, 1.0);
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 r;
        uniform float t;

        // Uniforms for new formula
        uniform float u_kaleidoscope;
        uniform float u_waveBase;
        uniform float u_waveHeight;
        uniform vec2 u_shapePos;
        uniform vec2 u_pOffset;
        uniform float u_stepFactor;
        uniform float u_dFactor;
        uniform float u_colorFalloff;

        // Corrected tanh_approx to work with vec4
        vec4 tanh_approx(vec4 x) {
            vec4 x2 = x * x; 
            vec4 x3 = x2 * x; 
            vec4 x5 = x3 * x2;
            return clamp(x - x3/3.0 + 2.0*x5/15.0, -1.0, 1.0);
        }

        void main() {
            vec2 FC = gl_FragCoord.xy;
            vec4 o;
            vec2 p = (FC.xy * 2.0 - r) / r.y;

            if (u_kaleidoscope > 0.5) {
                float angle = 3.14159 / 3.0;
                float a = atan(p.y, p.x);
                float rad = length(p);
                a = mod(a, angle * 2.0) - angle;
                p = rad * vec2(cos(a), sin(a));
            }
            
            vec2 p_original = p;
            
            vec2 a = vec2(p.y, sqrt(abs(p*p*p)) / (u_waveBase + p.y * u_waveHeight));
            
            float d = min(
                log(exp(length(a)/0.1 - 5.0 - 5.0*a.y) + exp(2.4 - length(p/0.1-u_shapePos))),
                length((p -= u_pOffset) - u_stepFactor * step(p, p.yx))/0.1 - 3.0
            );
            
            o = tanh_approx((cos(p.y / (0.3 + u_dFactor * d * d) + t + vec4(0,1,2,0)) + 1.1) * (u_colorFalloff / max(d/0.2, 0.1-d)));
            
            gl_FragColor = o;
        }
    </script>

    <!-- 
      Main Application Script:
      Placed at the end of the body to be non-render-blocking.
      Per instructions, the contents of this script have NOT been modified.
    -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('menu-toggle');
            const settingsPanel = document.getElementById('settings-panel');
            menuToggle.addEventListener('click', () => {
                const isOpen = menuToggle.classList.toggle('open');
                settingsPanel.classList.toggle('open');
                menuToggle.setAttribute('aria-expanded', isOpen);
            });

            const canvas = document.getElementById('glCanvas');
            const gl = canvas.getContext('webgl');
            if (!gl) {
                console.error("WebGL not supported!");
                document.body.innerHTML = "Sorry, your browser does not support WebGL."
                return;
            }

            // --- Shader Program Setup ---
            function createProgram(vertexSource, fragmentSource) {
                function createShader(type, source) {
                    const shader = gl.createShader(type); gl.shaderSource(shader, source); gl.compileShader(shader);
                    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                        console.error('Shader compile error: ' + gl.getShaderInfoLog(shader)); gl.deleteShader(shader); return null;
                    } return shader;
                }
                const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);
                const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);
                const program = gl.createProgram(); gl.attachShader(program, vertexShader); gl.attachShader(program, fragmentShader); gl.linkProgram(program);
                if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                    console.error('Program link error: ' + gl.getProgramInfoLog(program)); return null;
                } return program;
            }
            const program = createProgram(document.getElementById('vertex-shader').text, document.getElementById('fragment-shader').text);
            if (!program) return;
            gl.useProgram(program);

            // --- Geometry & Uniform Locations ---
            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]), gl.STATIC_DRAW);
            const positionAttributeLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionAttributeLocation);
            gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);
            const resolutionLocation = gl.getUniformLocation(program, "r");
            const timeLocation = gl.getUniformLocation(program, "t");

            // --- Settings Definition ---
            const settings = [
                { id: 'u_kaleidoscope', name: 'Kaleidoscope', type: 'toggle', value: 0.0 },
                { id: 'u_waveBase', name: 'Wave Base', type: 'slider', min: 0.1, max: 1.0, step: 0.01, value: 0.5 },
                { id: 'u_waveHeight', name: 'Wave Height', type: 'slider', min: -1.0, max: 1.0, step: 0.01, value: 0.2 },
                { id: 'u_shapePos_x', name: 'Shape Pos X', type: 'slider', min: -10.0, max: 10.0, step: 0.1, value: 5.0 },
                { id: 'u_shapePos_y', name: 'Shape Pos Y', type: 'slider', min: -10.0, max: 10.0, step: 0.1, value: 1.0 },
                { id: 'u_pOffset_x', name: 'P-Offset X', type: 'slider', min: -2.0, max: 2.0, step: 0.01, value: 0.0 },
                { id: 'u_pOffset_y', name: 'P-Offset Y', type: 'slider', min: -2.0, max: 2.0, step: 0.01, value: 0.6 },
                { id: 'u_stepFactor', name: 'Step Factor', type: 'slider', min: 0.0, max: 1.0, step: 0.01, value: 0.3 },
                { id: 'u_dFactor', name: 'D Factor', type: 'slider', min: 0.0, max: 0.5, step: 0.01, value: 0.1 },
                { id: 'u_colorFalloff', name: 'Color Falloff', type: 'slider', min: 0.0, max: 2.0, step: 0.01, value: 0.4 },
            ];

            // --- UI Generation & State Management ---
            const uniformLocations = {};
            const uniformValues = {};
            const controlsContainer = document.getElementById('controls-container');
            
            // Clear existing controls
            controlsContainer.innerHTML = '';
            
            settings.forEach(setting => {
                const uniformName = setting.id.includes('_') ? setting.id.replace(/_[xy]$/, '') : setting.id;
                if (!uniformLocations.hasOwnProperty(uniformName)) {
                    uniformLocations[uniformName] = gl.getUniformLocation(program, uniformName);
                    if (uniformLocations[uniformName] === null) console.warn(`Uniform '${uniformName}' not found.`);
                }
                uniformValues[setting.id] = setting.value;

                if (setting.type === 'toggle') {
                    const card = document.createElement('div'); card.className = 'toggle-card';
                    const wrapper = document.createElement('div'); wrapper.className = 'toggle-wrapper';
                    const label = document.createElement('span'); label.className = 'toggle-label'; label.textContent = setting.name;
                    const switchLabel = document.createElement('label'); switchLabel.className = 'toggle-switch';
                    const input = document.createElement('input'); input.type = 'checkbox';
                    input.checked = setting.value > 0.5;
                    const sliderSpan = document.createElement('span'); sliderSpan.className = 'toggle-slider';
                    input.addEventListener('change', (e) => {
                        uniformValues[setting.id] = e.target.checked ? 1.0 : 0.0;
                    });
                    switchLabel.appendChild(input); switchLabel.appendChild(sliderSpan);
                    wrapper.appendChild(label); wrapper.appendChild(switchLabel);
                    card.appendChild(wrapper);
                    controlsContainer.appendChild(card);
                } else {
                    const card = document.createElement('div'); card.className = 'control-card';
                    const labelWrapper = document.createElement('div'); labelWrapper.className = 'control-label-wrapper';
                    const label = document.createElement('label'); label.htmlFor = setting.id; label.className = 'control-label'; label.textContent = setting.name;
                    const valueSpan = document.createElement('span'); valueSpan.className = 'control-value'; valueSpan.textContent = setting.value.toFixed(setting.step < 0.1 ? 3 : 2);
                    const sliderContainer = document.createElement('div'); sliderContainer.className = 'slider-container';
                    const trackFill = document.createElement('div'); trackFill.className = 'slider-track-fill';
                    const input = document.createElement('input'); input.type = "range"; input.id = setting.id; input.min = setting.min; input.max = setting.max; input.step = setting.step; input.value = setting.value;
                    const updateTrackFill = () => {
                        const percent = ((input.value - input.min) / (input.max - input.min)) * 100;
                        trackFill.style.width = `${percent}%`;
                    };
                    input.addEventListener('input', (e) => {
                        const value = parseFloat(e.target.value);
                        uniformValues[setting.id] = value;
                        valueSpan.textContent = value.toFixed(setting.step < 0.1 ? 3 : 2);
                        updateTrackFill();
                    });
                    labelWrapper.appendChild(label); labelWrapper.appendChild(valueSpan);
                    sliderContainer.appendChild(trackFill); sliderContainer.appendChild(input);
                    card.appendChild(labelWrapper); card.appendChild(sliderContainer);
                    controlsContainer.appendChild(card);
                    updateTrackFill();
                }
            });

            // --- Render Loop ---
            function render(time) {
                time *= 0.001;
                const displayWidth = window.innerWidth;
                const displayHeight = window.innerHeight;
                if (gl.canvas.width !== displayWidth || gl.canvas.height !== displayHeight) {
                    gl.canvas.width = displayWidth;
                    gl.canvas.height = displayHeight;
                    gl.viewport(0, 0, gl.canvas.width, gl.canvas.height);
                }

                gl.useProgram(program);
                gl.uniform2f(resolutionLocation, gl.canvas.width, gl.canvas.height);
                gl.uniform1f(timeLocation, time);

                Object.keys(uniformLocations).forEach(name => {
                    const loc = uniformLocations[name];
                    if (loc === null) return;
                    if (name.endsWith('Pos') || name.endsWith('Offset')) {
                        gl.uniform2f(loc, uniformValues[`${name}_x`], uniformValues[`${name}_y`]);
                    } else {
                         gl.uniform1f(loc, uniformValues[name]);
                    }
                });

                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
                requestAnimationFrame(render);
            }
            requestAnimationFrame(render);
        });
    </script>
</body>
</html>
